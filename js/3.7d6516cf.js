(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"4xUk":function(e,n,t){"use strict";var r=t("wrQP"),a=t.n(r);a.a},"6Lju":function(e,n,t){"use strict";var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("transition",{attrs:{"enter-active-class":"animated fadeIn",appear:""}},[t("q-alert",{staticClass:"q-mb-sm",attrs:{color:"negative",icon:"error",appear:""}},[e._v("\n    "+e._s(e.type)+" not found\n  ")])],1)},a=[];r._withStripped=!0;var i={name:"notFound",props:["type"]},s=i,o=(t("4xUk"),t("KHd+")),u=Object(o["a"])(s,r,a,!1,null,"38f663b5",null);n["a"]=u.exports},"7XBu":function(e,n,t){"use strict";t.d(n,"b",function(){return r}),t.d(n,"d",function(){return a}),t.d(n,"c",function(){return i}),t.d(n,"a",function(){return s});var r={ADMIN:"fas fa-cog",PARENT:"fas fa-user",TEACHER:"fas fa-book",STUDENT:"fas fa-graduation-cap"},a={ADMIN:"Administrator",PARENT:"Parent",TEACHER:"Teacher",STUDENT:"Student"},i=[{label:"Admin",value:"ADMIN"},{label:"Student",value:"STUDENT"},{label:"Parent",value:"PARENT"},{label:"Teacher",value:"TEACHER"}];function s(e){return-1!==e.state.app.roles.indexOf("ADMIN")}},"8SjZ":function(e,n,t){"use strict";var r=t("wVPF"),a=t.n(r);a.a},A3SY:function(e,n,t){"use strict";t.d(n,"a",function(){return S}),t.d(n,"m",function(){return T}),t.d(n,"n",function(){return q}),t.d(n,"h",function(){return U}),t.d(n,"g",function(){return P}),t.d(n,"d",function(){return y}),t.d(n,"l",function(){return w}),t.d(n,"k",function(){return E}),t.d(n,"j",function(){return k}),t.d(n,"i",function(){return z}),t.d(n,"c",function(){return N}),t.d(n,"b",function(){return D}),t.d(n,"f",function(){return I}),t.d(n,"e",function(){return x});var r=t("VkAN"),a=t.n(r),i=t("lTCR"),s=t.n(i);function o(){var e=a()(["\n  mutation DisableUserMutation($id: ID!){\n    disableUser(where: {id: $id}) {\n      id\n      disabled\n    }\n  }\n"]);return o=function(){return e},e}function u(){var e=a()(["\n  mutation EnableUserMutation($id: ID!){\n    enableUser(where: {id: $id}) {\n      id\n      disabled\n    }\n  } \n"]);return u=function(){return e},e}function l(){var e=a()(["\n  mutation CreateUserAndAvatarMutation($name: String!, $email: String!, $timezone: String!, $avatarId: ID!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean, $sub: String!, $username: String!) {\n    createUser(\n      data: {\n        name: $name\n        username: $username\n        email: $email\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n        sub: $sub\n        avatar: {\n          connect: { id: $avatarId }\n        }\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      disabled\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      avatar {\n        url\n      }\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=a()(["\n  mutation CreateUserMutation($name: String!, $email: String!, $timezone: String!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean, $username: String!){\n    createUser(\n      data: {\n        name: $name\n        username: $username\n        email: $email\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      disabled\n      avatar {\n        url\n      }\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      username\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=a()(["\n  mutation UpdateProfileMutation($name: String!, $timezone: String!, $avatarId: ID!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean) {\n    updateProfile(\n      data: {\n        name: $name\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n        avatar: {\n          connect: { id: $avatarId }\n        }\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      disabled\n      avatar {\n        url\n      }\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=a()(["\n  mutation UpdateProfileMutation($name: String!, $timezone: String!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean) {\n    updateProfile(\n      data: {\n        name: $name\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      disabled\n      avatar {\n        url\n      }\n    }\n  }\n"]);return m=function(){return e},e}function f(){var e=a()(["\n  mutation updateUserMutation($name: String!, $timezone: String!, $id: ID!, $avatarId: ID!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean) {\n    updateUser(\n      where: {id: $id}\n      data: {\n        name: $name\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n        avatar: {\n          connect: { id: $avatarId }\n        }\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      disabled\n      avatar {\n        url\n      }\n    }\n  }\n"]);return f=function(){return e},e}function p(){var e=a()(["\n  mutation updateUserMutation($name: String!, $timezone: String!, $id: ID!, $isAdmin: Boolean, $isTeacher: Boolean, $isStudent: Boolean, $isParent: Boolean) {\n    updateUser(\n      where: {id: $id}\n      data: {\n        name: $name\n        timezone: $timezone\n        isAdmin: $isAdmin\n        isTeacher: $isTeacher\n        isStudent: $isStudent\n        isParent: $isParent\n      }\n    ){\n      id\n      name\n      email\n      timezone\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      disabled\n      avatar {\n        url\n      }\n    }\n  }\n"]);return p=function(){return e},e}function h(){var e=a()(["\n  mutation deleteUserMutation($id: ID!) {\n    deleteUser(where: {id: $id }) {\n      id\n    }\n  }\n"]);return h=function(){return e},e}function $(){var e=a()(["\n  query me {\n    me {\n      id\n      sub\n      name\n      email\n      timezone\n      disabled\n      avatar {\n        url\n      }\n      isAdmin\n      isTeacher\n      isStudent\n      isParent\n      username\n    }\n  }\n"]);return $=function(){return e},e}function b(){var e=a()(["\n  query ProfileQuery {\n    user: profile {\n      id\n      sub\n      name\n      email\n      timezone\n      disabled\n      avatar {\n        url\n      }\n      isAdmin\n      isTeacher\n      isParent\n      isStudent\n      username\n    }\n  }\n"]);return b=function(){return e},e}function v(){var e=a()(["\n  query userQuery($id: ID!) {\n    user( where: {id: $id} ) {\n      id\n      sub\n      name\n      email\n      timezone\n      disabled\n      avatar {\n        url\n      }\n      isAdmin\n      isTeacher\n      isParent\n      isStudent\n      username\n    }\n  }\n"]);return v=function(){return e},e}function g(){var e=a()(["\n  subscription UsersSubscription {\n    userSubscription {\n      mutation\n      node {\n        id\n        sub\n        name\n        email\n        avatar {\n          url\n        }\n        createdAt\n        updatedAt\n        isAdmin\n        isTeacher\n        isParent\n        isStudent\n        disabled\n      }\n      previousValues {\n        id\n      }\n    }\n  }\n"]);return g=function(){return e},e}function A(){var e=a()(["\n  query AllUsersQuery {\n    users(orderBy: name_ASC) {\n      id\n      name\n      email\n      avatar {\n        url\n      }\n      createdAt\n      updatedAt\n      isAdmin\n      isTeacher\n      isParent\n      isStudent\n      disabled\n      username\n    }\n  }\n"]);return A=function(){return e},e}var S=s()(A()),T=s()(g()),q=s()(v()),U=s()(b()),P=s()($()),y=s()(h()),w=s()(p()),E=s()(f()),k=s()(m()),z=s()(c()),N=s()(d()),D=s()(l()),I=s()(u()),x=s()(o())},nJZ3:function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("q-page",{staticClass:"page",attrs:{padding:""}},[e.found?[e.user.disabled?[t("div",{staticClass:"q-title text-center q-pb-lg"},[e._v("User is Disabled")])]:e._e(),t("q-field",{staticClass:"q-mb-md",attrs:{icon:"person",label:"Name",helper:"Enter your full name",error:e.$v.user.name.$error,"error-label":"Please enter your full name"}},[t("q-input",{directives:[{name:"delayfocus",rawName:"v-delayfocus"}],attrs:{type:"text"},on:{blur:e.$v.user.name.$touch},model:{value:e.user.name,callback:function(n){e.$set(e.user,"name","string"===typeof n?n.trim():n)},expression:"user.name"}})],1),t("q-field",{staticClass:"q-mb-md",attrs:{icon:"lock",label:"Username",helper:"Enter the username",error:e.$v.user.username.$error,"error-label":"Enter a username"}},[t("q-input",{attrs:{type:"text",disable:!e.isNewUser},on:{blur:e.$v.user.username.$touch},model:{value:e.user.username,callback:function(n){e.$set(e.user,"username","string"===typeof n?n.trim():n)},expression:"user.username"}})],1),t("q-field",{ref:"emailWrapper",staticClass:"q-mb-md",attrs:{icon:"mail",label:"Email",helper:"The email used to create this account",error:this.$v.user.email.$error||this.emailError,"error-label":e.emailErrorText}},[t("q-input",{attrs:{type:"email",disable:!e.isNewUser},on:{blur:e.checkEmailError,keyup:function(n){return"button"in n||!e._k(n.keyCode,"enter",13,n.key,"Enter")?e.updateUser(n):null}},model:{value:e.user.email,callback:function(n){e.$set(e.user,"email","string"===typeof n?n.trim():n)},expression:"user.email"}})],1),t("q-field",{staticClass:"q-mb-md",attrs:{icon:"access_time",label:"Time Zone",helper:"Your local timezone",error:e.$v.user.timezone.$error,"error-label":"Please select your Time Zone"}},[t("q-select",{attrs:{options:e.timezones},on:{blur:e.$v.user.timezone.$touch},model:{value:e.user.timezone,callback:function(n){e.$set(e.user,"timezone",n)},expression:"user.timezone"}})],1),e.isAdmin&&(e.userId||e.isNewUser)?t("q-field",{staticClass:"q-mb-md",attrs:{icon:"verified_user",label:"Personas",helper:"Personas available to this profile",error:e.$v.user.timezone.$error,"error-label":"Please select your Time Zone"}},[t("q-option-group",{attrs:{type:"toggle",options:e.availableRoles},model:{value:e.user.roles,callback:function(n){e.$set(e.user,"roles",n)},expression:"user.roles"}})],1):e._e(),t("q-field",{staticClass:"q-mb-md",attrs:{icon:"add_a_photo",label:"Avatar",helper:"The image that will be used as your avatar"}},[t("q-uploader",{ref:"avatar",attrs:{url:e.url,headers:e.authHeader,extensions:".gif,.jpg,.jpeg,.png","auto-expand":"","hide-upload-button":""},on:{uploaded:e.uploaded}})],1),e.canDelete?t("q-btn",{staticClass:"on-left q-mt-lg q-mr-xs",attrs:{loading:e.$apollo.loading,color:"negative",label:"Delete Profile",rounded:"",push:""},on:{click:e.deleteUser}},[t("q-spinner-facebook",{attrs:{slot:"loading"},slot:"loading"})],1):e._e()]:t("notFound",{attrs:{type:"User"}}),t("q-layout-footer",[t("q-toolbar",{attrs:{inverted:""}},[t("q-toolbar-title"),t("q-btn",{staticClass:"uppercase",attrs:{color:"secondary",label:"Cancel",flat:!0},on:{click:function(n){e.$router.replace({name:e.$route.meta.backRoute})}}}),e.isAdmin&&!e.isNewUser?[e.user.disabled?t("q-btn",{staticClass:"uppercase",attrs:{loading:e.$apollo.loading,color:"primary",label:"Enable",flat:!0},on:{click:e.enableUser}},[t("q-spinner-facebook",{attrs:{slot:"loading"},slot:"loading"})],1):t("q-btn",{staticClass:"uppercase",attrs:{loading:e.$apollo.loading,color:"primary",label:"Disable",flat:!0},on:{click:e.disableUser}},[t("q-spinner-facebook",{attrs:{slot:"loading"},slot:"loading"})],1),t("q-btn",{staticClass:"uppercase",attrs:{loading:e.$apollo.loading,color:"primary",label:"Delete",flat:!0},on:{click:e.deleteUser}},[t("q-spinner-facebook",{attrs:{slot:"loading"},slot:"loading"})],1)]:e._e(),t("q-btn",{staticClass:"uppercase",attrs:{loading:e.$apollo.loading,color:"primary",label:e.updateLabel,disable:e.$v.$invalid,flat:!0},on:{click:e.updateUser}},[t("q-spinner-facebook",{attrs:{slot:"loading"},slot:"loading"})],1)],2)],1)],2)},a=[];r._withStripped=!0;t("pIFo"),t("ls82");var i=t("yXPU"),s=t.n(i),o=(t("f3/d"),t("A3SY")),u=t("K405"),l=t("ta7f"),d=t("hkKY"),c=t("7XBu"),m=t("uZRx"),f=t("6Lju"),p={name:"editUser",components:{notFound:f["a"]},data:function(){return{user:{name:"",email:"",timezone:"",roles:[],username:""},url:"".concat(window.__httpEndpoint,"/avatar"),timezones:d["a"].map(function(e){return{label:e.name,value:e.name}}),userId:this.$route.params.id,mutation:o["l"],emailError:!1,found:!0,availableRoles:c["c"],canDelete:!1,authHeader:{}}},validations:function(){var e={user:{email:{required:l["required"],email:l["email"]},name:{required:l["required"]},timezone:{required:l["required"]},roles:{required:l["required"]},username:{required:l["required"]}}};return e},computed:{isNewUser:function(){return"new_user"===this.$route.name},emailErrorText:function(){return this.emailError?"Email address is in use by another profile":"Please type a valid email"},isAdmin:function(){return Object(c["a"])(this.$store)},updateLabel:function(){return this.isNewUser?"Create Profile":"Update Profile"}},methods:{disableUser:function(){var e=this;this.$apollo.mutate({mutation:o["e"],variables:{id:this.user.id}}).then(function(n){e.$q.notify({message:"User profile for ".concat(e.user.name," was disabled"),type:"negative"})}).catch(function(){})},enableUser:function(){var e=this;this.$apollo.mutate({mutation:o["f"],variables:{id:this.user.id}}).then(function(n){e.$q.notify({message:"User profile for ".concat(e.user.name," was enabled"),type:"positive"})}).catch(function(){})},getAuthHeader:function(){var e=s()(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m["Auth"].currentSession();case 2:n=e.sent.getAccessToken().getJwtToken(),this.authHeader={Authorization:"Bearer ".concat(n)};case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),deleteUser:function(){var e=this;this.$q.actionSheet({title:"Delete profile for ".concat(this.user.name,"?"),actions:[{label:"Delete",color:"primary",icon:"fas fa-trash",handler:function(){e.$apollo.mutate({mutation:o["d"],variables:{id:e.user.id}}).then(function(n){e.$q.notify({message:"User profile was for ".concat(e.user.name," was sucessfully deleted"),type:"negative"}),e.$router.replace("/users")})}}]}).then(function(e){}).catch(function(){})},checkEmailError:function(){this.emailError=!1,this.$v.user.email.$touch()},uploaded:function(e,n){var t=JSON.parse(n.response);this.user.avatarId=t.id,this.$refs.avatar.reset(),this.updateUser()},setUserRoles:function(){this.user.isAdmin=-1!==this.user.roles.indexOf("ADMIN"),this.user.isTeacher=-1!==this.user.roles.indexOf("TEACHER"),this.user.isStudent=-1!==this.user.roles.indexOf("STUDENT"),this.user.isParent=-1!==this.user.roles.indexOf("PARENT")},updateUser:function(){var e=s()(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthHeader();case 2:if(this.userId||this.mutation===o["i"]||(this.mutation=o["j"]),this.isNewUser&&this.mutation!==o["b"]&&(this.mutation=o["c"]),!this.$refs.avatar.files.length){e.next=9;break}return this.mutation=this.isNewUser?o["b"]:o["k"],this.userId||(this.mutation=o["i"]),this.$refs.avatar.upload(),e.abrupt("return");case 9:this.setUserRoles(),this.$apollo.mutate({mutation:this.mutation,variables:this.user}).then(function(e){var t=n.isNewUser?"created":"updated";n.$q.notify({message:"Profile was sucessfully ".concat(t),type:"positive"}),n.isNewUser&&n.$router.replace("/users/"+e.data.createUser.id)}).catch(function(e){var t=e.message;console.log(t),"GraphQL error: A unique constraint would be violated on User. Details: Field name = email"===t&&(n.emailError=!0)}),this.mutation=o["l"],this.$root.$emit("apollo_loading",!1);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},apollo:{user:{query:function(){return this.userId?o["n"]:o["h"]},variables:function(){return{id:this.userId}},skip:function(){return this.isNewUser},update:function(e){e.user.id||(this.found=!1);var n=Object(u["Ja"])(this.user,e.user);return n.roles=[],e.user.isAdmin&&n.roles.push("ADMIN"),e.user.isTeacher&&n.roles.push("TEACHER"),e.user.isStudent&&n.roles.push("STUDENT"),e.user.isParent&&n.roles.push("PARENT"),n}}}},h=p,$=(t("8SjZ"),t("KHd+")),b=Object($["a"])(h,r,a,!1,null,"6800c306",null);n["default"]=b.exports},wVPF:function(e,n,t){},wrQP:function(e,n,t){}}]);